autoencoder: &autoencoder
  typename: Sequential
  args:
    input_config:
      typename: Input
      reuse: True
      name: input_image
    layer_configs:
      - typename: TrueDiv
        args:
          denom: 255
          name: layer0/preprocessing
      #--------------------
      - typename: Conv2D
        args: &conv2d_1
          n_filters: 32
          filter_width: 5
          filter_height: 5
          strides: 2
          padding: valid
          name: layer1/conv2D
      - typename: ReLU
        args:
          name: layer1/ReLU
      #--------------------
      - typename: BatchNormalization
        args:
          name: layer2/BN
      #--------------------
      - typename: Conv2D
        args: &conv2d_2
          n_filters: 64
          filter_width: 3
          filter_height: 3
          strides: 2
          padding: valid
          name: layer3/conv2D
      - typename: ReLU
        args:
          name: layer3/ReLU
      #--------------------
      - typename: BatchNormalization
        args:
          name: layer4/BN
      #--------------------
      - typename: Conv2DTranspose
        args:
          << : *conv2d_2
          name: layer5/conv2DTranspose
        parameters:
          filter:
            typename: Variable
            name: layer3/conv2D/filter
          original_input:
            typename: Tensor
            name: layer2/BN/output
      - typename: ReLU
        args:
          name: layer5/ReLU
      #--------------------
      - typename: BatchNormalization
        args:
          name: layer6/BN
      #--------------------
      - typename: Conv2DTranspose
        args:
          << : *conv2d_1
          name: layer7/conv2DTranspose
        parameters:
          original_filter:
            typename: Variable
            name: layer1/conv2D/filter
          original_input:
            typename: Tensor
            name: layer0/preprocessing/output

error: &error
  typename: Graph
  args:
    node_configs:
      - typename: SSE
        args:
          name: error/SSE
        input:
          - typename: Input
            reuse: True
            name: input_image
          - typename: Tensor
            name: layer7/conv2DTranspose/output

typename: Container
args:
  input_config:
    typename: Input
    args:
      name: input_image
      shape: {input_shape}
  output_config:
    typename: Tensor
    name: error/SSE/output
  model_configs: &model_configs
    - << : *autoencoder
      name: autoencoder
    - << : *error
      name: error
